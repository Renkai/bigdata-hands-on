<!DOCTYPE html>
<html class="no-js" lang="zh-CN" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scala入门(一)</title>
    <link rel="stylesheet" href="theme/css/foundation.min.css">
    <link rel="stylesheet" href="theme/css/app.css">
    
     <link rel="stylesheet" href="theme/highlight.js/styles/github-gist.css">  <link rel="stylesheet" href="theme/css/foundation-icons.custom.css"> 
    
     <link rel="prev" href="index.html"  title="Scala 语言入门:材料准备"  />  <link rel="next" href="learn_scala_2.html"  title="Scala入门(二)"  />  <link rel="start" href="index.html"  title="Scala 语言入门:材料准备"  />  <link rel="toc" href="site-contents.html"  title="Table of Contents"  /> 
  </head>
  <body>
    <div class="expanded row">
      <div class="small-12 medium-12 large-12 columns align-self-top">
        <div class="row">
          
          <header class="large-12 columns align-self-top a_header">
            <div class="row">
              <div class="large-12 columns a_limited top-bar">
                <div class="top-bar-left">
                  <p>Fordeal数据平台 技术讲义</p>

                </div>
                <div class="top-bar-right align-right row">
                  
                  
                    <form action="site-search.html" method="get" class="align-right a_search">
                      <input name="q" type="search"  placeholder="Search
" >
                      <button><img alt="&#1F50D;" src="theme/images/search.svg" /></button>
                    </form>
                  
                </div>
              </div>
            </div>
          </header>
          
          <div class="small-12 medium-12 large-12 columns align-self-top a_limited a_main">
            <div class="row">
              
              <main class="columns large-order-2 sections" id="_sections">
                 
  <ul class="menu align-right simple a_navbar a_navbar_top">
    
      
        <li><a href="index.html"  title="Scala 语言入门:材料准备" ><span class="a_foundation_icon"></span>  Previous</a></li>
      
    
      
        <li><a href="learn_scala_2.html"  title="Scala入门(二)" ><span class="a_foundation_icon"></span>  Next</a></li>
      
    
      
        <li><a href="site-contents.html"  title="Table of Contents" ><span class="a_foundation_icon"></span>  Contents</a></li>
      
    
  </ul>
 
                
                <h1 id="scala入门一" class="a_section" data-magellan-target="scala入门一">Scala入门(一)<a class="a_hlink" href="#scala入门一"></a></h1>
<h2 id="值和变量" class="a_section" data-magellan-target="值和变量">值和变量<a class="a_hlink" href="#值和变量"></a></h2>
<p>Scala中有两个关键词,<code class="hljs language-scala"><span class="hljs-keyword">val</span></code>(value)和<code class="hljs language-scala"><span class="hljs-keyword">var</span></code>(variable),分别用来定义一个值和变量,一个值大体上可以等价于Java中带final修饰符的变量.下方展示了Scala中定义值和变量的方法以及在Java中大致等价的代码.</p>
<ul class="tabs" data-tabs id="_id0"><li class="tabs-title is-active"><a href="#_id1" aria-selected="true">Scala</a></li><li class="tabs-title"><a href="#_id2">Java</a></li></ul>
<div class="tabs-content" data-tabs-content="_id0"><div class="tabs-panel is-active" id="_id1">
<div class="row"><div class="a_linked small-expand columns a_xscroll a_codeblock">
<pre class="hljs"><code class="language-scala"><span class="hljs-keyword">val</span> a = <span class="hljs-number">3</span>
<span class="hljs-keyword">var</span> b = <span class="hljs-string">"string"</span>
</code></pre>
</div></div>
</div><div class="tabs-panel" id="_id2">
<div class="row"><div class="a_linked small-expand columns a_xscroll a_codeblock">
<pre class="hljs"><code class="language-java"><span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> a = <span class="hljs-number">3</span>;
String b = <span class="hljs-string">"string"</span>;
</code></pre>
</div></div>
</div></div>
<h2 id="类型" class="a_section" data-magellan-target="类型">类型<a class="a_hlink" href="#类型"></a></h2>
<p><img src="images/tumblr_lylhmlhD061qd12yo.png" alt="image" /></p>
<p>上面一幅图介绍了现在各个主流编程语言的静态类型/动态类型,强类型/弱类型属性,关于这幅图片的原始文章可以看<a href="https://dustyprogrammer-blog.tumblr.com/post/16746798643/should-your-start-up-go-static-or-dynamic">这里</a>,网上还有许多讨论,比如<a href="https://segmentfault.com/a/1190000012372372">这里</a>和<a href="https://www.zhihu.com/question/19918532">这里</a>,本文不再赘述.我主要想介绍的是,Scala其实是静态强类型语言,很多缺少了解的人粗略看一些源码,见到一个<code class="hljs language-scala"><span class="hljs-keyword">var</span> ...</code>就认为是JavaScript那样的动态弱类型语言,这个理解是错误的.</p>
<p>为什么一个静态强类型语言会容易被人误认为是弱类型语言呢?这其中的关键在于<a href="https://zh.wikipedia.org/wiki/%E7%B1%BB%E5%9E%8B%E6%8E%A8%E8%AE%BA">类型自动推导</a>.有更多兴趣的人可以看看<a href="https://www.zhihu.com/search?type=content&amp;q=%E7%B1%BB%E5%9E%8B%E6%8E%A8%E5%AF%BC">知乎相关文章</a>.如果您关心C++和Java的话,应该知道<a href="https://en.cppreference.com/w/cpp/language/auto">C++11</a>和<a href="https://openjdk.java.net/projects/amber/LVTIFAQ.html">Java11</a>都已经有了类型自动推导的特性,遗憾的是,由于实际工作环境中的历史遗留问题,很多C++和Java用户不知道什么时候才能真的用上这些特性.</p>
<p>在Scala里情况就好多了, Scala从最早的版本开始就支持类型自动推导,您可以打开Ammonite试试键入<code class="hljs language-scala"><span class="hljs-keyword">val</span> a=<span class="hljs-number">3</span></code>,和<code class="hljs language-scala"><span class="hljs-keyword">val</span> b:<span class="hljs-type">Int</span> = <span class="hljs-number">3</span></code>还有<code class="hljs language-scala"><span class="hljs-keyword">val</span> c: <span class="hljs-type">String</span> = <span class="hljs-number">3</span></code>看看结果.</p>
<div class="row"><div class="a_linked small-expand columns a_xscroll a_codeblock">
<pre class="hljs"><code class="language-scala">➜  ~ amm
<span class="hljs-type">Loading</span>...
<span class="hljs-type">Welcome</span> to the <span class="hljs-type">Ammonite</span> <span class="hljs-type">Repl</span> <span class="hljs-number">1.6</span><span class="hljs-number">.8</span>
(<span class="hljs-type">Scala</span> <span class="hljs-number">2.13</span><span class="hljs-number">.0</span> <span class="hljs-type">Java</span> <span class="hljs-number">1.8</span><span class="hljs-number">.0</span>_181)
<span class="hljs-type">If</span> you like <span class="hljs-type">Ammonite</span>, please support our development at www.patreon.com/lihaoyi
renkai-renkai@ <span class="hljs-keyword">val</span> a = <span class="hljs-number">3</span>
a: <span class="hljs-type">Int</span> = <span class="hljs-number">3</span>

renkai-renkai@ <span class="hljs-keyword">val</span> b: <span class="hljs-type">Int</span> = <span class="hljs-number">3</span>
b: <span class="hljs-type">Int</span> = <span class="hljs-number">3</span>

renkai-renkai@ <span class="hljs-keyword">val</span> c: <span class="hljs-type">String</span> = <span class="hljs-number">3</span>
cmd2.sc:<span class="hljs-number">1</span>: <span class="hljs-class"><span class="hljs-keyword">type</span> <span class="hljs-title">mismatch</span></span>;
 found   : <span class="hljs-type">Int</span>(<span class="hljs-number">3</span>)
 required: <span class="hljs-type">String</span>
<span class="hljs-keyword">val</span> c: <span class="hljs-type">String</span> = <span class="hljs-number">3</span>
                ^
<span class="hljs-type">Compilation</span> <span class="hljs-type">Failed</span>
</code></pre>
</div></div>
<p>您可以看到,定义一个<code class="hljs language-scala"><span class="hljs-keyword">val</span> a = <span class="hljs-number">3</span></code>,编译器会自动推导出<code class="hljs language-scala">a</code>的类型是<code class="hljs language-scala"><span class="hljs-type">Int</span></code>,如果您希望在代码里指定类型好在阅读源码的时候获得一些安全感,Scala当然也是支持的<code class="hljs language-scala"><span class="hljs-keyword">val</span> b: <span class="hljs-type">Int</span> = <span class="hljs-number">3</span></code>的效果和<code class="hljs language-scala"><span class="hljs-keyword">val</span> a = <span class="hljs-number">3</span></code>效果一样,区别在于编译器不再为您做自动推导而是做一个检查类型是否匹配的工作,如果类型匹配没有问题,则相安无事.如果类型匹配出问题了,编译器会在编译期就抛出错误,从而避免更大的损失在运行期发生.</p>
<h3 id="特殊类型介绍" class="a_section" data-magellan-target="特殊类型介绍">特殊类型介绍<a class="a_hlink" href="#特殊类型介绍"></a></h3>
<p><img src="images/unified-types-diagram.svg" alt="Scala Type Hierarchy" /></p>
<p>上图是一个Scala类型体系的介绍图,图片来源在<a href="https://docs.scala-lang.org/tour/unified-types.html">官方网站</a>.</p>
<p>我们在这里额外解释一些特殊类型:</p>
<p><code class="hljs language-scala"><span class="hljs-type">Unit</span></code>:</p>
<p>​	Unit<code class="hljs language-scala">大体上相当于java中的</code>void<code class="hljs language-scala">,将一个表达式或者函数的返回值设置为</code>Unit`,表示您不关心它们的返回值是什么.</p>
<p><code class="hljs language-scala"><span class="hljs-type">Nothing</span></code>:</p>
<p>​	<code class="hljs language-scala"><span class="hljs-type">Nothing</span></code>是所有类型的子类,就我目前的工作经验而言,<code class="hljs language-scala"><span class="hljs-type">Nothing</span></code>类的主要作用是辅助您设计代码结构.Scala为您内置了这样一个方法</p>
<div class="row"><div class="a_linked small-expand columns a_xscroll a_codeblock">
<pre class="hljs"><code class="language-scala">  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">???</span> </span>: <span class="hljs-type">Nothing</span> = <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-type">NotImplementedError</span>
</code></pre>
</div></div>
<p>当您想做些代码原型设计的时候,需要定义一些函数的参数返回值类型,但还暂时不知道怎么写实现的时候,就可以用上它.比如您想设计一个抽奖系统,但是暂时还不知道怎么获得具体的范围人群,也不知道抽奖算法要怎么设计.就可以这样写</p>
<div class="row"><div class="a_linked small-expand columns a_xscroll a_codeblock">
<pre class="hljs"><code class="language-scala">  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">getEmployeeSet</span></span>(): <span class="hljs-type">Set</span>[<span class="hljs-type">String</span>] = ???

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">getLuckyOne</span></span>(employeeSet: <span class="hljs-type">Set</span>[<span class="hljs-type">String</span>]): <span class="hljs-type">String</span> = ???

  getLuckyOne(getEmployeeSet())
</code></pre>
</div></div>
<p>这些代码能通过编译,但是运行的时候会抛异常.这种做法很适合在给一个已经存在的项目增添代码的时候,做到既能提交局部成果到代码仓库,又不破坏代码的可编译性.</p>
<h2 id="表达式" class="a_section" data-magellan-target="表达式">表达式<a class="a_hlink" href="#表达式"></a></h2>
<p>如您所见,Scala中的<code class="hljs language-scala"><span class="hljs-keyword">val</span></code>可以在Java中找到一个大致对应的关键词<code class="hljs language-scala"><span class="hljs-keyword">final</span></code>,但是在实际工作经验中,Scala中的<code class="hljs language-scala"><span class="hljs-keyword">val</span></code>出现的频率要远高于Java中的<code class="hljs language-scala"><span class="hljs-keyword">final</span></code>.为什么会这样?这里就要提到一个概念叫表达式(<a href="https://en.wikipedia.org/wiki/Expression_(computer_science)">Expression</a>). 在Java里,基础的<a href="https://docs.oracle.com/javase/tutorial/java/nutsandbolts/expressions.html">数学运算</a>是表达式,<a href="https://docs.oracle.com/javase/tutorial/java/javaOO/lambdaexpressions.html">lambda表达式</a>是表达式.还有什么呢?好像没有了.</p>
<p>在Scala里,情况就不太一样了,所有代码都会是表达式.举个例子,假设我们在没有充分利用Scala表达式特性的情况下想要根据不同的网络环境定义不一样的域名,可以这样写</p>
<div class="row"><div class="a_linked small-expand columns a_xscroll a_codeblock">
<pre class="hljs"><code class="language-scala">  <span class="hljs-keyword">var</span> urlString: <span class="hljs-type">String</span> = <span class="hljs-literal">null</span>
  <span class="hljs-keyword">val</span> hostName = <span class="hljs-type">InetAddress</span>.getLocalHost.getHostName
  <span class="hljs-keyword">if</span> (isInnerHost(hostName)) {
    urlString = <span class="hljs-string">"http://inner.host"</span>
  } <span class="hljs-keyword">else</span> {
    urlString = <span class="hljs-string">"http://outter.host"</span>
  }
</code></pre>
</div></div>
<p>这段代码应该熟悉Java的人阅读起来都不会有什么困难,定义一个变量<code class="hljs language-scala">urlString</code>,如果网络环境是内网,就把<code class="hljs language-scala"><span class="hljs-string">"http://inner.host"</span></code>赋值给<code class="hljs language-scala">urlString</code>,不然就将<code class="hljs language-scala"><span class="hljs-string">"http://outter.host"</span></code>赋值给<code class="hljs language-scala">urlString</code>.</p>
<p>这段代码能够工作良好,不过还有一些安全隐患,那就是在<code class="hljs language-scala">urlString</code>被第一次赋值后,它就没有被再一次变更的必要了,可是编译器仍然为它保留着再一次被变更的可能性.也就是说,您可能在之后的代码中因为一些误操作改变<code class="hljs language-scala">urlString</code>的值,造成bug.我的一位前同事就因为类似原因造成的bug排查不出来,查了一整天,几近崩溃.(当然,这和他变量名习惯起a1,a2...的恶习也分不开).</p>
<p>那么有什么办法能让<code class="hljs language-scala">urlString</code>被赋上需要的值,又能让它在赋值后保持不变,避免被误操作修改呢?我们来看一个充分利用了Scala表达式特性的版本</p>
<div class="row"><div class="a_linked small-expand columns a_xscroll a_codeblock">
<pre class="hljs"><code class="language-scala"><span class="hljs-keyword">val</span> hostName = <span class="hljs-type">InetAddress</span>.getLocalHost.getHostName
<span class="hljs-keyword">val</span> urlString = <span class="hljs-keyword">if</span> (isInnerHost(hostName)) {
  <span class="hljs-string">"http://inner.host"</span>
} <span class="hljs-keyword">else</span> {
  <span class="hljs-string">"http://outter.host"</span>
}
</code></pre>
</div></div>
<p><code class="hljs language-scala"><span class="hljs-string">"http://inner.host"</span></code>是表达式,<code class="hljs language-scala"><span class="hljs-string">"http://outter.host"</span></code>是表达式,<code class="hljs language-scala"><span class="hljs-keyword">if</span>(...) {...}<span class="hljs-keyword">else</span>{...}</code>也是表达式,三个表达式一组合,我们就获得了我们需要的<code class="hljs language-scala">urlString</code>,并且它是一个值而非变量,也就是说我们可以把它放心暴露在命名空间中而不用担心它被变更了.</p>
<h2 id="习题" class="a_section" data-magellan-target="习题">习题<a class="a_hlink" href="#习题"></a></h2>
<p>按照<a href="index.html#习题集">材料准备</a>里的提示把习题下载到本地,编辑<code class="hljs language-scala">src/main/scala/quiz/<span class="hljs-type">Quiz1</span>.scala</code>,更改文件中的<code class="hljs language-scala">???</code>为您的答案.在项目根目录下执行<code class="hljs language-scala">./gradlew run --args=<span class="hljs-symbol">'quiz</span>.<span class="hljs-type">Quiz1</span>'</code>,获得以下输出说明习题完成.</p>
<div class="row"><div class="a_linked small-expand columns a_xscroll a_codeblock">
<pre class="hljs"><code>1 + 1 = 2
小目标达成
</code></pre>
</div></div>
<p>参考答案在<code class="hljs language-scala">src/main/scala/answer/<span class="hljs-type">Answer1</span>.scala</code>中</p>

                 
  <ul class="menu align-right simple a_navbar a_navbar_bottom">
    
      
        <li><a href="index.html"  title="Scala 语言入门:材料准备" ><span class="a_foundation_icon"></span>  Previous</a></li>
      
    
      
        <li><a href="learn_scala_2.html"  title="Scala入门(二)" ><span class="a_foundation_icon"></span>  Next</a></li>
      
    
      
        <li><a href="site-contents.html"  title="Table of Contents" ><span class="a_foundation_icon"></span>  Contents</a></li>
      
    
  </ul>
 
              </main>
              
              
                <div data-sticky-container class="small-12 medium-12 large-2 large-order-1 columns a_sitenav_container">
                  <nav class="a_sitenav" data-sticky data-sticky-on="large" data-anchor="_sections">
                    
                    <ul>
                       
  <li >
    
      
        <a href="index.html">Scala 语言入门:材料准备</a>
      
    
    
  </li>
  
  <li  class="a_thispage" >
    
      
        <a href="learn_scala_1.html">Scala入门(一)</a>
      
    
    
  </li>
  
  <li >
    
      
        <a href="learn_scala_2.html">Scala入门(二)</a>
      
    
    
  </li>
  
  <li >
    
      
        <a href="learn_scala_3.html">Scala入门(三)</a>
      
    
    
  </li>
  
  <li >
    
      
        <a href="learn_scala_attach.html">Scala入门(附录)</a>
      
    
    
  </li>
 
                    </ul>
                    
                    
                  </nav>
                </div>
              
              
              
                <div class="small-12 medium-12 large-2 large-order-3 columns a_show-for-xlarge" data-sticky-container>
                  <nav class="a_pagenav" data-sticky data-sticky-on="large" data-anchor="_sections">
                     <header><p>On This Page</p>
</header> 
                    <ul class="vertical menu" data-magellan>
                       
  
    <li>
      
         <a href="#scala入门一">Scala入门(一)</a> 
      
      
        <ul class="vertical menu">  
  
    <li>
      
         <a href="#值和变量">值和变量</a> 
      
      
    </li>
  
  
  
    <li>
      
         <a href="#类型">类型</a> 
      
      
        <ul class="vertical menu">  
  
    <li>
      
         <a href="#特殊类型介绍">特殊类型介绍</a> 
      
      
    </li>
  
  </ul>
      
    </li>
  
  
  
    <li>
      
         <a href="#表达式">表达式</a> 
      
      
    </li>
  
  
  
    <li>
      
         <a href="#习题">习题</a> 
      
      
    </li>
  
  </ul>
      
    </li>
  
 
                    </ul>
                  </nav>
                </div>
              
            </div>
          </div>
        </div>
      </div>
      
      <footer class="small-12 medium-12 large-12 columns align-self-bottom a_footer">
        <div class="row">
          <div class="small-12 medium-12 large-12 columns top-bar">
            <div class="top-bar-left">
              
            </div>
            <div class="top-bar-right">
              <p>Generated with <a href="https://github.com/szeiger/ornate">Ornate</a>.</p>

            </div>
          </div>
        </div>
      </footer>
    </div>
    
    <script src="theme/js/jquery.min.js"></script>
    <script src="theme/js/what-input.min.js"></script>
    <script src="theme/js/foundation.min.js"></script>
    
    <script src="theme/js/app.js"></script>
    
  </body>
</html>
